<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
  <div id="basic" style="text-align:center;">
    <video class="videostream" autoplay=""></video>
    <audio class="audiostream" autoplay=""></audio>
    <p>
      <button class="capture-button">Capture</button>
      <button id="stop-button">Stop</button>
    </p>
    <img id="imgTag">
  </div>
  <script>
    const video = document.querySelector('#basic video');
    const audio = document.querySelector('#basic audio');
    const imgTag = document.querySelector('#basic img');
    let canvas = document.createElement('canvas');
    canvas.width = 640;
    canvas.height = 480;

    const captureVideoButton = document.querySelector('#basic .capture-button');
    const stopVideoButton = document.querySelector('#basic #stop-button');

    //Capture Video
    captureVideoButton.onclick = function() {
       navigator.mediaDevices.getUserMedia({
        audio: true,
        video: true
      })
      .then(stream => {
        window.localStream = stream;
        video.srcObject = stream;
        audio.srcObject = stream;
      })
      .catch((err) => {
        console.log(err);
      });
      setTimeout(takeScreenshot, 4000);
    };
    function takeScreenshot(){
      let ctx = canvas.getContext('2d');
      ctx.drawImage( video, 0, 0, canvas.width, canvas.height );
      let image = canvas.toDataURL('image/jpeg');
      imgTag.src = image;
      localStream.getVideoTracks()[0].stop();
      video.src = '';

      localStream.getAudioTracks()[0].stop();
      audio.src = '';
    }
    stopVideoButton.onclick = function() {
      localStream.getVideoTracks()[0].stop();
      video.src = '';

      localStream.getAudioTracks()[0].stop();
      audio.src = '';
    };
  </script>
</body>
</html>